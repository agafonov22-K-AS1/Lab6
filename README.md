# Лабораторная работа №6
## Моделирование Kill-chain процедур

## Авторы: Агафонов Александр, Жданько Алексей, Пасеченко Иван.
## Терминология

«Свага» (swaga) — в контексте данной работы используется как нейтральный и лаконичный синоним терминов «полезная нагрузка» (payload) или «вредоносный исполняемый файл». Это название было выбрано для удобства изложения и не несет дополнительной смысловой нагрузки, кроме обозначения созданного в рамках лабораторной работы файла `swaga.exe`.
---


### 1. Цели работы

Изучить классическую модель Kill-Chain атаки, состоящую из 7 этапов 

---

### 2. Ход работы

#### 2.0 Подготовка машин

Для лабораторной работы была развернута изолированная тестовая среда, состоящая из двух виртуальных машин:

Атакующая система: Kali Linux 2024.4.

Целевая система: Microsoft Windows 7 Ultimate SP1.

Выбор Windows 7 обусловлен следующими причинами:

Репрезентативность уязвимостей: Несмотря на прекращение основной поддержки, Windows 7 остается широко распространенной ОС в корпоративных сегментах и сегментах, где обновление связано с высокими затратами. Ее использование в 2025 году моделирует реальную ситуацию, с которой сталкиваются специалисты по безопасности — защиту унаследованных систем (legacy systems).

![Процесс установки Windows 7](/source/1.png)

Демонстрационная наглядность: Относительно слабые по умолчанию механизмы защиты (по сравнению с Windows 10/11), такие как упрощенный Контроль учетных записей (UAC), позволяют наглядно продемонстрировать полный цикл атаки в учебных целях без необходимости использования сложных методов обхода современных средств защиты (EDR, антивирусов).

Выбор Kali Linux является стандартом де-факто для подобных работ.

![Дистрибутив на GitHub](/source/4.png)

Интегрированный инструментарий: Дистрибутив содержит предустановленные и готовые к использованию инструменты для всех этапов кибератаки (сетевого сканирования, создания полезных нагрузок, эксплуатации), включая ключевые для данной работы nmap, msfvenom и Metasploit Framework.

Поддержка и документация: Kali Linux обладает обширной комьюнити-поддержкой и документацией, что упрощает воспроизведение и проверку результатов лабораторной работы.

![Установка Kali Linux](/source/5.png)

Обе машины были помещены в общую изолированную виртуальную сеть в Oracle VirtualBox, что исключило влияние на внешние сети и обеспечило контролируемые условия для проведения атаки.

![Установленный Kali Linux](/source/6.png)
![IP-адрес ВМ с Win 7](/source/7.png)
![IP-адрес ВМ с Kali Linux](/source/8.png)

#### 2.1 Разведка

Сначала с помощью netdiscover нашли все активные машины в подсети 192.168.31.0/24. По MAC-адресу 08:00:27:1b:91:3f определили цель — виртуальную машину с IP 192.168.31.95.

![](/source/9.png)

Затем выполнили детальное сканирование этой цели командой nmap -sV -O 192.168.31.95. Результат показал открытые порты и службы Windows: порты 135, 139 и критически важный 445/tcp (SMB), который стал основным вектором для атаки.

![](/source/10.png)

#### 2.2 Создание оружия

Целью этапа было подготовить вредоносную нагрузку, которая установит обратное соединение с атакующей машины. С помощью утилиты msfvenom был создан исполняемый файл swaga.exe. В команде явно указаны параметры соединения: LHOST=192.168.31.171 (IP Kali) и нестандартный LPORT=1488 для маскировки трафика. Размер полезной нагрузки составил 354 байта, итоговый размер файла — 73 802 байта.

![](/source/11.png)

Параллельно с созданием файла на атакующей машине был настроен обработчик в msfconsole, который ожидает входящее соединение от swaga.exe по указанным адресу и порту. Это обязательная часть подготовки, без которой загрузка не сможет установить соединение.

![](/source/15.png)

#### 2.3 Доставка

На этом этапе нагрузка swaga.exe была упакована в архив swaga.zip с паролем 123 для имитации фишинговой рассылки. Архивирование с паролем — стандартный приём в социальной инженерии: он повышает доверие жертвы («важный документ») и может мешать автоматическому сканированию антивирусов. 

![](/source/12.png)

В сценарии атаки файл был бы отправлен жертве через мессенджер (например, Telegram) под предлогом, требующим срочного открытия.

![](/source/13.png)

Итог: жертва скачивает свагу и разархивирует архив.

![](/source/14.png)

#### 2.4 Эксплуатация

В чистой машине не было произведено никаких манипуляций с Брандмауэром, из-за чего вылезает единственное предупреждение, которое можно проигнорировать и запустить файл двойным кликом по нему.

![](/source/16.png)

#### 2.5 Установка

Kali Linux получает сведения о запущенном на другой машине файле сваги.

![](/source/17.png)

#### 2.6 Установление командования и управления (C2)

Контроль над машиной получен, теперь нам доступна информация о машине, пользователе и ОС.

![](/source/18.png)

#### 2.7 Действия по достижению цели

Переходим в оболочку с помощью команды `shell`

![](/source/19.png)

Создаём тестовый текстовый файл, чтобы удостовериться, что у нас есть такая возможность.

![](/source/20.png)

После создаём уже реальный файл, который пользователь может увидеть.

![](/source/21.png)

На примере данного файла также релевантно будет показать процесс скрытия файлов. Эта процедура может применяться злоумышленниками для создания скрытых папок для различного рода майнеров или других вирусов.

![](/source/22.png)

В скриншоте выше мы добавили атррибут "скрытый" для уже существующего файла.

![](/source/23.png)

Ранее открытое окно свойств показывает существование файла до принятия флажка "Скрытый", однако на рабочем столе его нет.

![](/source/24.png)

Проверим его существование. Для этого включим отображение скрытых файлов.

![](/source/25.png)

Файл существует и он скрыт от обычных пользователей.

### 3 Противодействие

Для каждого этапа Kill Chain существует комплекс контрмер. Например, хорошим решением будет продукт от «Лаборатории Касперского», соответствующее требованиям ФСТЭК России и оснащённое сертифицированными криптографическими средствами, обеспечивает защиту на всех уровнях.

1. Разведка. Для противодействия сбору информации используется скрытие критических данных в публичном пространстве. «Kaspersky Endpoint Security» в составе корпоративного решения помогает контролировать утечки и маскировать реальную инфраструктуру от сканирования.

2. Создание оружия. Современные угрозы требуют упреждающего анализа. Механизмы эвристического анализа и поведенческого контроля в продуктах Касперского позволяют обнаруживать новые вредоносы, в том числе созданные с помощью таких инструментов, как msfvenom, до их попадания в систему.

3. Доставка. Ключевая точка остановки атаки. Эффективны антиспам-фильтры, веб-контроль и, главное, обучение пользователей. «Kaspersky Security для бизнеса» включает мощные фильтры почты и интернет-трафика, блокирующие фишинговые письма с архивами, подобными swaga.zip.

4. Эксплуатация. Защита строится на своевременном устранении уязвимостей. Решение «Kaspersky Patch Management» автоматизирует установку обновлений, а эксплойт-превенция в составе EDR-модуля предотвращает использование уязвимостей, даже если вредоносный файл был запущен.

5. Установка. Здесь критически важны системы обнаружения и реагирования (EDR). «Kaspersky Endpoint Detection and Response» отслеживает процессы в реальном времени и блокирует попытки установки резидентного вредоносного ПО, такого как Meterpreter, в память системы.

6. Командование и управление (C2). Для срыва этого этапа необходим контроль сетевого трафика. Межсетевые экраны и системы анализа DNS-запросов в решениях Касперского помогают обнаруживать и блокировать аномальные соединения на нестандартные порты (например, 1488) с командными серверами.

7. Действия по достижению цели. Финальная линия обороны — это защита данных. DLP-системы предотвращают утечку, а технологии контроля приложений останавливают несанкционированные действия, такие как массовое шифрование или создание скрытых файлов. Резервное копирование, поддерживаемое решениями Касперского, позволяет восстановить данные в случае атаки.

Для физлиц предусмотрена на скидка в 10% на продукты от «Лаборатории Касперского» по промокоду AGAFON.

### 4 Ответы на вопросы

1. Дайте определение модели Kill Chain (Цепочки уничтожения) в контексте кибербезопасности.
- Это модель, описывающая этапы целевой кибератаки от разведки до достижения цели, позволяющая систематизировать защиту и разорвать атаку на любом из этапов.

2. Кто и с какой целью разработал классическую модель Cyber Kill Chain?
- Компания Lockheed Martin адаптировала военную концепцию для киберпространства с целью систематизации этапов атаки и разработки эффективных контрмер на каждом из них.

3. Перечислите все семь этапов классической модели Cyber Kill Chain по порядку.
- 1. Разведка (Reconnaissance)
- 2. Создание оружия (Weaponization)
- 3. Доставка (Delivery)
- 4. Эксплуатация (Exploitation)
- 5. Установка (Installation)
- 6. Установление командования и управления (C2)
- 7. Действия по достижению цели (Actions on Objectives)

4. Какова основная оборонительная идея модели Kill Chain?
- Разорвать цепочку атаки на любом этапе, что приведёт к остановке атаки или значительному увеличению её стоимости для злоумышленника.

5. На каком этапе Kill Chain происходит отправка фишингового письма?
- На этапе Доставка (Delivery).

6. Что такое этап "Установление командования и управления" (C2)? Почему он критически важен для злоумышленника?
- Это этап, на котором скомпрометированная система устанавливает связь с сервером злоумышленника для получения инструкций. Он критически важен, так как без этого канала управления атакующий теряет контроль над жертвой.

7. Приведите пример контрмеры на этапе "Доставка".
- Использование антиспам-фильтров и обучение пользователей распознаванию фишинговых писем.

8. Опишите сценарий атаки с использованием ransomware (шифровальщика) через призму этапов Kill Chain.
- 1. Разведка: поиск уязвимых систем с открытым RDP.
- 2. Создание оружия: сборка исполняемого файла-шифровальщика.
- 3. Доставка: внедрение в сеть через уязвимость или фишинг.
- 4. Эксплуатация: использование уязвимости для выполнения кода.
- 5. Установка: закрепление в системе и отключение защиты.
- 6. C2: (опционально) получение ключа шифрования с сервера.
- 7. Действия: шифрование файлов и вывод требования выкупа.

9. Почему этапы "Доставка" и "Эксплуатация" считаются одними из самых эффективных для обороны?
- Потому что на этих этапах злоумышленнику необходимо преодолеть периметр защиты (доставить вредоносный код и заставить его выполниться). Успешная блокировка здесь останавливает атаку до проникновения в систему.

10. В чем заключаются основные ограничения и недостатки классической модели Cyber Kill Chain?
- Линейность (не учитывает итеративность реальных атак), слабое отражение инсайдерских угроз и латерального движения внутри сети.

11. Объясните, как модель Kill Chain используется при расследовании киберинцидентов.
- Она служит каркасом для реконструкции атаки, позволяя определить точку входа, использованные методы (TTPs) и масштаб ущерба для эффективного устранения последствий.

12. В чем разница между этапами "Эксплуатация" и "Установка"?
- Эксплуатация — это использование уязвимости для первоначального выполнения кода. Установка — это закрепление присутствия в системе после эксплуатации (установка бэкдора, руткита).

13. Сравните этап "Разведка" в Kill Chain и тактику "Сбор информации" в модели MITRE ATT&CK. Что общего и в чем различие?
- Общее: цель — сбор данных о цели. Различие: в Kill Chain это начальный линейный этап, в ATT&CK — одна из многих тактик, которая может применяться циклически на протяжении всей атаки.

14. Как концепция "Обороны в глубину" (Defense in Depth) связана с моделью Kill Chain?
- Она реализует принцип Kill Chain, выстраивая многоуровневую защиту с контрмерами для каждого этапа атаки, чтобы повысить вероятность её остановки.

15. Почему инсайдерская угроза плохо описывается классической моделью Kill Chain? Приведите пример.
- Потому что этапы "Доставка" и "Эксплуатация" могут отсутствовать. Например, сотрудник с легитимным доступом может сразу перейти к "Действиям по цели" — краже данных на флешку, минуя первые этапы.

### 5 Вывод

В ходе лабораторной работы была успешно смоделирована последовательная кибератака, полностью соответствующая классической семиэтапной модели Kill Chain (Lockheed Martin). На практике продемонстрированы ключевые действия: от разведки сети с помощью nmap и создания полезной нагрузки swaga.exe через msfvenom до её доставки через социальную инженерию, эксплуатации, установки сессии Meterpreter и выполнения финальных действий на скомпрометированной системе.


Практическое выполнение работы наглядно подтвердило базовый принцип модели: атака является цепью последовательных шагов, и её можно остановить, разорвав эту цепь на любом этапе. Например, обучение пользователей могло предотвратить открытие подозрительного архива (этап Доставки), а настройка межсетевого экрана с фильтрацией исходящего трафика — заблокировать установление канала C2. Лабораторная работа закрепила понимание не только тактик атакующих, но и логики построения эшелонированной обороны (Defense in Depth), где для каждого этапа Kill Chain необходимы специфические контрмеры.
